<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Tutorial HTK: Reconocedor de Dígitos en español.  : HTK, Dígitos, Español" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Tutorial HTK: Reconocedor de Dígitos en español. </title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/pbrusco">View on GitHub</a>

          <h1 id="project_title">Tutorial HTK: Reconocedor de Dígitos en español. </h1>
          <h2 id="project_tagline">HTK, Dígitos, Español</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>Tarea</h3>

<p>A continuación implementaremos un reconocedor de dígitos en español, para ello utilizaremos HTK (una implementación de <a href="http://es.wikipedia.org/wiki/Modelo_oculto_de_M%C3%A1rkov">Modelos Ocultos de Markov</a> y seguiremos los pasos recomendados en el <a href="http://htk.eng.cam.ac.uk/docs/docs.shtml">manual de HTK</a> </p>

<h3>Hacia dónde vamos?</h3>

<p>La idea de este tutorial es lograr, a partir de grabaciones de audio que contienen dígitos (solo dígitos),  obtener la transcripción de salida. </p>

<h3>Entrada</h3>

<p><img src="https://dl.dropboxusercontent.com/u/43547597/12151516790.png" alt="12151516790"></p>

<h3>Salida</h3>

<p>12151516790</p>

<h3>Preparando el entorno</h3>

<h3>Organización del código</h3>

<p>Para lograr hacer funcionar el programa, deberemos fijar la ubicación de cada uno de los archivos que creemos, recomiendo utilizar la misma estructura que yo utilizo ya que los comandos están preparados para estas rutas. Por supuesto, al ir entendiendo cada uno de los comandos y scripts, los archivos podrán ser movidos a donde el que los utilice considere.</p>

<h2>Primer Parte: Preparando los datos.</h2>

<h3>Paso 1: Gramática</h3>

<p>Para que nuestro programa entienda palabras, lo primero que debemos indicarle es que forma pueden tener las oraciones que grabemos.</p>

<p>Dado que en nuestro caso queremos reconocer dígitos, lo haremos con la siguiente gramática (llamaremos a este archivo <code>grammar</code>:</p>

<pre><code>$digito = UNO | DOS | TRES | CUATRO | CINCO | SEIS | SIETE | OCHO | NUEVE | CERO;
( SENT-START ( &lt;$digito&gt; ) SENT-END )
</code></pre>

<p>Básicamente, se indica a través</p>

<p>Create the phones dictionary and list:</p>

<pre><code>HDMan -m -w Dictionary/DictionarySources/words-sorted.list -n Dictionary/phones.list -l dlog Dictionary/phones.dict Dictionary/DictionarySources/dict
</code></pre>

<p>Remove sp from phones.list and create another file including it (phones-with-sp.list)</p>

<p>Convert the grammar into a wordnet format:</p>

<pre><code>HParse Dictionary/DictionarySources/grammar Dictionary/DictionarySources/grammar.wordnet 
</code></pre>

<p>Create "MFCCs words.mlf"</p>

<pre><code>irb Helpers/generate_mfccs_from_training.rb
</code></pre>

<p>(then, modify each element to contain a word transcription of what each file says)</p>

<p>Transcribe words.mlf into phones.mlf (for training data in this case):</p>

<pre><code>HLEd -l ’*’ -d Dictionary/phones.dict -i Data/train\ MFCCs-phones.mlf Configs/HLEd.config Data/train\ MFCCs-words.mlf
</code></pre>

<p>Generate HCopy.script </p>

<pre><code>irb Helpers/generate_hcopy_script.rb
</code></pre>

<p>Generate MFCCs from wavs:</p>

<pre><code>HCopy -T 1 -C Configs/HCopy.config -S Scripts/HCopy.script
</code></pre>

<p>Create directories for models:</p>

<pre><code>for NUMBER in {0..9}
do
  mkdir Models/hmm$NUMBER
done
</code></pre>

<p>Generate HCompV.script file:</p>

<pre><code>irb Helpers/generate_hcompv_script.rb
</code></pre>

<p>Train first prototype model into hmm0 folder:</p>

<pre><code>HCompV -C Configs/HCompV.config -f 0.01 -m -S Scripts/HCompV.script -M Models/hmm0 Models/prototype
</code></pre>

<p>--copy prototype to hmmdefs (to each phoneme) --
--copy vFloors to macros -- </p>

<p>Generate HERest.script file:</p>

<pre><code>irb Helpers/generate_herest_script.rb
</code></pre>

<p>Generate and copy labels files into train folder. </p>

<pre><code>irb Helpers/labels_from_wavs_script.rb "Data/Recorded/waves/train/" "Data/Train/"
</code></pre>

<p>(assuming each file has the same name that the label)</p>

<p>Re-estimate using embedded re-estimation tool HERest:</p>

<pre><code>HERest -T 1 -C Configs/HERest.config -I Data/train\ MFCCs-phones.mlf -t 1000.0 1000.0 10000.0 -S Scripts/HERest.script -H Models/hmm0/macros -H Models/hmm0/hmmdefs -M Models/hmm1 Dictionary/phones.list
HERest -T 1 -C Configs/HERest.config -I Data/train\ MFCCs-phones.mlf -t 1000.0 1000.0 10000.0 -S Scripts/HERest.script -H Models/hmm1/macros -H Models/hmm1/hmmdefs -M Models/hmm2 Dictionary/phones.list
HERest -T 1 -C Configs/HERest.config -I Data/train\ MFCCs-phones.mlf -t 1000.0 1000.0 10000.0 -S Scripts/HERest.script -H Models/hmm2/macros -H Models/hmm2/hmmdefs -M Models/hmm3 Dictionary/phones.list
</code></pre>

<p>(After adding the new "sp" state after copying from hmm3 to hmm4 and adding sp using center state of sil) (<a href="http://www.voxforge.org/home/dev/acousticmodels/linux/create/htkjulius/tutorial/monophones/step-7">http://www.voxforge.org/home/dev/acousticmodels/linux/create/htkjulius/tutorial/monophones/step-7</a>)</p>

<pre><code>HHEd -A -D -T 1 -H Models/hmm4/macros -H Models/hmm4/hmmdefs -M Models/hmm5 Configs/HHEd.config Dictionary/phones-with-sp.list
</code></pre>

<pre><code>HERest -T 1 -C Configs/HERest.config -I Data/train\ MFCCs-phones.mlf -t 1000.0 1000.0 10000.0 -S Scripts/HERest.script -H Models/hmm5/macros -H Models/hmm5/hmmdefs -M Models/hmm6 Dictionary/phones-with-sp.list
HERest -T 1 -C Configs/HERest.config -I Data/train\ MFCCs-phones.mlf -t 1000.0 1000.0 10000.0 -S Scripts/HERest.script -H Models/hmm6/macros -H Models/hmm6/hmmdefs -M Models/hmm7 Dictionary/phones-with-sp.list
</code></pre>

<p>Test models: 
Generate tests MFCCs:</p>

<pre><code>HCopy -T 1 -C Configs/HCopyTests.config -S Scripts/HCopyTests.script
</code></pre>

<p>Results:</p>

<pre><code>HVite -H Models/hmm7/macros -H Models/hmm7/hmmdefs -S Scripts/HVite.script -l ’*’ -i recout.mlf -w Dictionary/DictionarySources/grammar.wordnet -p 0.0 -s 5.0 Dictionary/phones.dict Dictionary/phones-with-sp.list
</code></pre>

<p>Live Results:
HVite -H Models/hmm7/macros -H Models/hmm7/hmmdefs -C Configs/Live.config -w Dictionary/DictionarySources/grammar.wordnet -p 0.0 -s 5.0 Dictionary/phones.dict Dictionary/phones-with-sp.list</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
